<html>
<head>
<title>Session Life Saver Options</title>
<script src='jquery-1.7.2.min.js'></script>
</head>
<script type="text/javascript">
    function saveOptions() {
        var options = new Array();
        $.each($(".optionline"), function(index, value) {
            var option = {};
            option.trigger = $(value).find('.triggeroption').val();
            option.ping = $(value).find('.pingoption').val();
            option.time = $(value).find('.timeoption').val();
            options.push(option);
        });

        localStorage["sessionlifesaver"] = JSON.stringify(options);

        $('#feedback').html("Options Saved.");
        setTimeout(function() {
            $('#feedback').html("");
        }, 750);
    }

    function restoreOptions() {
        var options = JSON.parse(localStorage["sessionlifesaver"]);
        if (!options) {
            return;
        }

        for ( var i = 0; i < options.length; i++) {
            var value = options[i];
            addOption(value.trigger, value.ping, value.time);
        }
    }
    
    function removeOption( val ) {
        $(val).parent().parent().remove();
    }

    function buildOptionLine(trigger, ping, time) {
        return '<tr class="optionline"><td><input type="text" class="triggeroption" value="'+trigger+'"></input></td><td><input type="text" class="pingoption" value="'+ping+'"></input></td><td><input type="text" class="timeoption" value="'+time+'"></input></td><td><button onclick="removeOption(this);">Remove</button></tr>';
    }

    function addOption(trigger, ping, time) {
        $("#options").append(buildOptionLine(trigger, ping, time));
    }
</script>

<body onload="restoreOptions()">

    <h2>Options</h2>

    <div>
        <span id="feedback"></span>
    </div>
    
    <p>For a new entry you will need:
        <br>
        - url to listen for as trigger
        <br>
        - url to ping when the first url is found in a tab of your chrome window
        <br>
        - repeating interval in minutes
    </p>
     

    <table id="options">
        <tr>
            <th>URL (Trigger)
            </th>
            <th>Url (Ping)
            </th>
            <th>Repeating interval (minutes)
            </th>
            <th>
            </th>
        </tr>
    </table>

    <br>
    <button onclick="addOption( '', '', '' );">Add new option</button> <button onclick="saveOptions()">Save</button> 
</body>
</html>